# 2017 学习

用法 -> 理解 -> 实践 -> 总结

技术三个层次，快速上线，架构，性能
技术专家vs创业
技术能做的可能不够，考虑团队，业务，产品
选择创业路会更宽阔，人脉的扩展，技术合伙人的身份切入
狭义都会导致短视，比如盲目认同技术，比如盲目认为业务无压力
考虑一下你几年后的样子，可能真的只能变成你现在看到的人
大公司面试技巧：不要讲太多，就讲自己深入的点
考虑快与慢
多一点时间考虑，行业要看清，如果真想创业，怎么赚钱是一定要考虑的问题
要敢于落地尝试，现在试错成本还很低
用空间替代时间: 从时间管理 -> 时间恒定, 管理是伪命题 -> 空间换时间

一个leader, 不提供思路, 只说还是得你自己看, 并且时间催得紧. -- 不要成为这个样子
先上，不快就死
公司上层架构, 股权分配
做不成就死，打仗
目标都是赢
手机号召回
运营成本 活得更久点
营造付费玩家的意识

IT界知名段子手，网络红人留几手曾经说： 对于那些月薪两万以下，自称程序员的码农们，其实我们从来没有把他们归为我们程序员的队伍。他们虽然总是以程序员自居，只是他们的一厢情愿罢了。
当你希望守护什么东西的时候你才会有力量

老兵不死，只是凋零
天下没有不散的筵席，我只能怀着感恩的心，认真对待每一天。
看源代码，是最快的学习方法。
而到了一个阶段，经验的积累，才是能让你再次进步的主要途径了。。。
终于明白为什么以前老觉得那些牛人怎么那么牛，说话高深莫测，嘿嘿，都是懒得多说一句话。。。。
无法进入一个拥有大规模并发请求的项目中得到历练，不坚持提升自己，那也只能在小公司混日子了。
关于编程语言: http://rango.swoole.com/archives/date/2015/01
硬件是科技的载体，软件是科技的灵魂，这些全部离不开编程技术。
关于 php 框架的一点思考: 框架首先为了提高生产力的, 为了方便快捷; 有必要了解一些「重」的框架, 足够重, 就表明足够「大型」, 能从中学习到的知识更多; 选择小而美, 因为可以完全驾驭
多使用官方文档，很多问题搜索不出来，但是官方文档很容易解决
php 想要达到的效果就是「简单」，比如直接在 html 代码中内嵌 php 代码。但是这条路注定要在未来淘汰，前后端分离（服务 api 化）能让系统轻易的扩展到不同终端。所以，未来的 php，一定要深挖服务器领域（beyond http）和 API
微博短链生成器：t.cn
发布后观察线上日志，确保服务正常
相信是别无选择 - 王坚
吃的草够多，你也能成为大牛
跨域：protocol + port + host
技术栈选择：laravel + vuejs + docker(alpine) + go + swoole + zan + python
向前端进击
潜心深究服务器，先做出一片天地再说
全自动 - 监控
外部接口都放入 service 项目中(建议采用 php, 灵活快速)
事务: 从原子性考虑, 比如同时更新 2 条记录
php 4 种回调函数风格 / xdebug 有页面可以查看安装失败
mysql: show processlist -> information_schema.`PROCESSLIST`
你会的都是理所应当, 也许什么时候就栽在不会的地方了
人生目标: 这个世界比我想象的复杂, 摆在我面前的有 2 条路, 写出足够复杂的代码应付它; 用代码让边简单, 哪怕还有一点点
人生信仰: 阳明心法
高并发下调试思路: 构建稳定高并发测试系统 / 复现 bug / gdb 和 debug 日志
DDD: 领域模型 / 抽象 / 设计模式
阿里云mq
人工智能创业: 流量红利消失 / 很多行业连接并不是痛点 / 人工智能提高生产力供需不平衡 / 上层垂直领域下层基础设施 / 行业壁垒 / 关键性应用 vs 非关键性应用 / 2c vs 2b

shell set -e 遇到错误后停止脚本执行
docker CMD ENTERPOINT CMD 的命令可以被 docker run/exec 覆盖

php5 power programming
head first php&mysql

从框架源码学习设计模式
测试的技巧: 先通过 Exception 获取输出, 通过后再写 equal
docker 极简镜像: 构建镜像 + 运行镜像 -> multi build

## 10x coder 2017-12-27 16:51:15

- keep your sane: 保持清醒, 工作 & 生活
- 善用工具
- 不要记忆 -> 索引
- 善于记录
- 设置闹钟 -> 专注
- 广交朋友
- 善用口诀
- 放弃完美 -> 那 1%, 也只属于那 1% 的人

## imooc 2017-12-27 11:12:48

- 微软雅黑 >= 20
- 大段代码, 边敲边讲解, 光标选中
- 英文单词发音准确
- 安静环境, 避免手机干扰
- 录完确认一遍

- 授课思路: 总(目标/场景/效果) - 分(知识重难点/原理分析/详细讲解) - 总(开发思路/梳理知识点)
- 讲课技巧: 轻松幽默; 语气/语调(抑扬顿挫/高低升降); 幽默感; 重点内容重点提示; 利用互动提高注意力

no 流水账式(填鸭式): 然后 -> 然后 -> 然后...

## 复杂性应对之道 2017-12-20 10:00:20

- 扩展点设计: 身份识别 扩展点
- 面向对象: 领域建模 SOLID 分层设计 规范设计

## 12factor 2017-12-19 18:51:07

- I. Codebase: One codebase tracked in revision control, many deploys
- II. Dependencies: Explicitly declare and isolate dependencies
- III. Config: Store config in the environment
- IV. Backing services: Treat backing services as attached resources
- V. Build, release, run: Strictly separate build and run stages
- VI. Processes: Execute the app as one or more stateless processes
- VII. Port binding: Export services via port binding
- VIII. Concurrency: Scale out via the process model
- IX. Disposability: Maximize robustness with fast startup and graceful shutdown
- X. Dev/prod parity: Keep development, staging, and production as similar as possible
- XI. Logs: Treat logs as event streams
- XII. Admin processes: Run admin/management tasks as one-off processes

## 2017-12-6 09:54:07

数据库2级分区表: 时间+业务(用户)
oceanBase: app -> ObProxy -> ObSerer(rootService)
2阶段提交, 表格组, 尽量避免分布式事务
高可用: paxos 协议
数据库引擎: B+树 / LSM树
多租户隔离: hypervisor cgroup(docker) sql-vm
webRTC
高性能 LB: cpu亲和; 大页内存, 避免虚拟内存被替换出内存; 无锁化, 环形无锁队列, RCU
CSP: Do not communicate by sharing memory; instead, share memory by communicating.

## rabbitmq 2017-11-26 11:14:47

ack: 消息确认
msg durability: msg persistence -> disk

## 2017-11-21 16:14:24

从小事做起，然后再扩展: 复杂系统总是源于简单系统的演化
一次只改变一件事
尽早地添加日志记录和错误处理
每一行新代码必须至少执行一次
在整体测试之前先进行模块测试
所有事情所花费的时间总是比你预期的要长
先了解现有的代码
阅读和运行
bug总是难免的
解决故障报告
重现问题
修复已知错误，然后再看看有没有遗漏的地方
没有巧合
关联时间戳
面对面的交流最有效
橡皮鸭法: 解决不了的问题和同事沟通
问问题
共享荣誉
尝试
带着问题睡觉
跳槽
不断学习

## 2017-11-22 12:30:14

耦合: ip -> DNS; 公共库/数据库耦合 -> 垂直拆分, 独立service; 服务化耦合 -> 业务功能上浮; 消息通知耦合 -> MQ; 下游扩容耦合 -> 配置中心

## 2017-11-20 10:05:58

- 苏宁api网关

一切基于标准: 命名(英文小写) 模式固定 简洁明了 有扩展性 分类/分层 -> suning.custom.order.get; 文档; 协议(http oauth); 服务契约化; 异常码标准化; 配置化; sdk化
重构: 响应; 并发支持; 接口分流;(强化接入层功能); 核心组件
高可用: 请求链路; 流量管控; 接口分流; 服务降级
监控: 实时日志(Elasticsearch 实时消费 kafka); 接口统计; 智能告警
应对O2O购物节

- 技术选型

选择最熟悉的技术 -> 稳定压倒一切
强大社区支持
确保技术前进步伐 -> 好的技术栈永远跑在用户需求前面
学会从业务端开始思考
先验证, 后使用
重视经验

## 龙果学院 2017-11-19 13:01:06

web: sql注入(过滤sql关键词) XSS跨站脚本 上传漏洞
appscan / safe3 web漏洞扫描
都需要大范围扫描, 可以通过分析日志封ip

日志: 基于环境配置(dev test prod)

dubbo 化改造: common facade service boss
大型系统详情页架构: nginx(html模板替换) + redis(分布式缓存) + 缓存服务 + MQ + 各个信息服务; request cache

## csphere 培训视频 2017-10-11 14:27:16
> http://csphere.cn/training

## 头条 2017-9-13 10:30:13

架构师 vs 技术专家: 广度 vs 深度
制定规范 + 指导落地
水平分层 + 垂直分层(分布式) + soa + 前后端分离 + 微服务
![微服务架构冰山模型](http://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuiaYbCHDsdVPOVYicYK54vnLZJz6jbqwRa7uPiaOsYDYQ5sIN8ahDa9qV1GMyJjPtuRCxFVDP8es1fQQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1)
切分服务边界: 梳理业务流程 / 抽取公共服务 / 定义业务服务 / 设计数据模型 / 定义服务接口
![轻量级微服务全局架构](http://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuiaYbCHDsdVPOVYicYK54vnLZNlgYibuZBKIuJmgTUkySpC69iaO6BRbTmOX2H0C0WF1eLl0rxqk7In4w/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1)

## linux 服务管理 2017-9-5 21:56:05
> 阮一峰 http://www.ruanyifeng.com/blog/2016/03/systemd-tutorial-commands.html

jobs fg bg disown 前台任务 / 后台任务: 当前 session 的 stdin
SIGHUP 信号: `shopt | grep huponexit`
nohup screen tmux
nodejs: forever nodemon pm2
init 进程: service nginx start
systemd: systemctl --version

- systemd 架构图

![](http://www.ruanyifeng.com/blogimg/asset/2016/bg2016030703.png)

## 招聘 2017-9-5 12:18:26

银行流水 绩效奖金 是否待满一年 学历 技术上面 晋升

## bilibili 面试 2017-9-4 11:08:26

epoll 原理
swoole 的进程模型, 进程间通信, unix socket 是否会存在问题
redis 存储大 value 的时候吞吐量会骤降
top k 算法
mysql: b+ tree / 索引 / explain 是否可以用到线上 / 强制指定索引

需要再补计算机基础: 算法 + 数据结构 + mysql + 网络/服务器

## mysql json 2017-9-2 12:43:30

json_keys(json_column)
json_extract(json_column, '$.key')

## 压测 2017-8-20 15:02:13

hello world
mysql
redis
cache

## pull push 2017-8-18 13:37:52

push: 实时
pull: 轮询
pull 长轮询: 增长等待 / 挂起连接而非直接 return
consumer 不在线: 消息超时

## slim 2017-8-17 15:01:22
## algolia 2017-8-17 14:48:00

Algolia is a hosted full-text, numerical, and faceted search engine capable of delivering realtime results from the first keystroke

data sync then index created: api / client / web dashboard
attribute: like key and has priority
ranking criterion
ui

## 编程语言的根性 2017-8-14 20:44:33

这个词首先会想到「伟大」的鲁迅先生，以及「我们民族的劣根性」。现实是鲁迅离中学课本越来越远了，但是读史越多，就越感觉到鲁迅先生透彻，成其「伟大」。

## mqtt 2017-8-14 17:18:49

apt-get install mosquitto mosquitto-clients
mosquitto_sub -d -t 'floor-5/temperature'
mosquitto_pub -d -t 'floor-5/temperature' -m '15'

mosquitto_sub -d -q 2 -t 'floor-5/temperature'
mosquitto_pub -d -q 2 -t 'floor-5/temperature' -m '15'

mosquitto -v
mosquitto_sub -v -t sensor
mosquitto_pub -t sensor -m 12

/etc/mosquitto/mosquitto.conf

## 面试

php: autoload spl psr mvc laravel package&ext
php 常见问题：sql array require/require_once
mysql: transaction explain master-slave migration slow-log bin-log
linux：lnmp log tail
cache
mongo
支付、金融、风控
项目难点、技术栈、技术规划、本科项目毕设
数据量、访问量、并发、架构、发布、线上问题处理、压测
行业、场景
502
url 流程
3 类网络地址

## wcq：海量服务 & hash
多级 hash
## wcq：服务器容灾和负载均衡
随机数 & 概率

## 风控数据统计需求

上报数据展示 - event_id - console
维度：event_id 、 时间（可以到小时）
某个时间段的总数

## aliyun docker 环境部署 2017-7-30 11:43:54

因为 腾讯云 快要到期，也准备 care 一下自己的环境，避免「没玩没了」的折腾环境，于是选择了阿里云。
本来环境是基于 docker 部署的，一直也很顺畅，但是这次上 aliyun 却一直报 「primary script not found」，围绕这个问题一直折腾了一周，期间不断尝试使用不同的 fpm（fpm、alpine-fpm，php-apache），设置直接起一个 nginx+fpm 的单 web 容器，问题依旧，最后直接 「chmod -R 777 /var/www」问题才得以解决

## ab test 技术分享 2017-5-27 11:04:55
AB test 、 灰度发布
## 监控系统 2017-5-22 11:42:09

脚本粒度：小时粒度太大，还是要到分（统计 + 报警）
报警粒度：先看监控面板，再定阀值
监控规则：城市、商户，还没有和风控打通
数值：绝对值、同比增长值、方差
离线 + 实时：数据并不是一开始就能确定的

接口异常

## 同 ip 攻击研究 2017-5-4 15:55:50

流量、速率控制
对人建模、反欺诈
h5、app：银行卡、设备指纹、通讯录（用户体验）
增加风控，增加权限

## infoq - 二叉树短视频 栏目 2017-5-1 17:25:09
很久之前在 infoq 的官网上看了「鸟哥」那集，后来就很少看到消息了，结果搜索了好久才在「腾讯视频」上找到
## 账务系统

6方账户：支付渠道，商户，用户，资金池，备用金，收益账户
面向业务流程设置对象
复式记账：借贷法

## 来自 hongqi 的分享 2017-2-15 14:45:33

快速理解新业务:跑一遍流程, 查看相关代码；查看数据表, 理解核心表, 状态转变
关于新人: 新人优先, 最高优先级; 新人要有产品体验报告(可以找测试帮助)
关于技术分享: 老人主要讲 设计的思想/当年踩过的坑; 新人来讲对 产品/项目 的理解

## 借贷宝典2017 2017-2-15 14:45:09

- 互联网小贷：蚂蚁借呗、微粒贷等
- 银行快贷
- p2p 平台贷款
- 抵押贷款产品：在贷款额度和贷款利率上,抵押贷款产品几乎可以秒杀无抵押贷款
- 分期贷款产品：蚂蚁花呗、京东白条等
- 手机贷款app
- 民营银行贷款产品

## SegmentFault 技术周刊 Vol.21 - 程序人生（二）：2016 这一年 2017-1-22 15:04:07

看多了奋斗，也容易让人热血起来；读多了故事了，也容易让人了解想要的人生，还可以是什么样的。摘录一点有意思的点：

- 2016 我的女朋友依旧没有出现
- 祝大家身体健康，世界和平
- 试用期早已计划好疯狂学习一个月，主动坚持 9117；试用期过后，应付工作仍然吃力，自觉又坚持 9117 两个月；这段时间找到造轮子的快乐，主动将 9117 延长至一年
- 平衡工作和生活，确保不猝死；护发
- 世界依旧很大，我们依旧很小
- 明年此时，期待字里行间多一分自信与从容，洒脱和无憾；纵年与时驰，可初心不改；即意与岁去，依激情满怀；当然：赚更多钱和提升自己，是大前提
- 不再像以前一样只无脑关心技术本身，而是更多地去思考技术之外的事，对待旧的代码更宽容了
- 用战术上的勤奋掩饰战略上的懒惰
- 有人说，爱上一份工作，可能是因为有一个好的 Leader，或者做的事让你有成就感；也有人说，员工的离职原因林林总总，只有两点最真实，一是「钱，没给到位」，二是「心，委屈了」，那么你呢？
- 总的来说这一年过得很充实也很荒诞，希不希望新的一年更操蛋一点？可以的，不折腾不成活！（md，看到自己的影子）
- 之前问过一位学长:"面经很重要么？"回答曰："面经的重要程度就像你大学考前复习一样"
- 致力于做一个有故事的人。小时候听爸爸说他的故事，长大了去创造自己的故事；当父亲后有故事可讲；老了以后有故事可以回味
- 拥抱自己所热爱的，即是正义
- 这些年我一直提醒自己一件事情，千万不要自己感动自己 —— 知乎

## 如果你还年轻，如何思考未来 2017-1-22 10:16:50
> 原文 http://mp.weixin.qq.com/s/t_carACh1XPsxF7hEhDIzg
> 百度脑图 http://naotu.baidu.com/file/74c8fa3fe1a4576d7abba9cf7f7bb8f2?token=4f79a25c112f78ff

鸡汤不重要，重要的是你煲的人生汤，什么需要加入一点

## 美团点评风控系统构建经验 2017-1-21 23:05:54
> http://mp.weixin.qq.com/s/qzUjZ1zuUeB2vpRmmbMH9w

- 接入成本：业务系统 -》中间系统、服务（用户中心、商户中心、支付环节）-》风控
- 运行成本：服务稳定性（隔离部署、依赖降级、限流防刷）、服务性能（同步控制接口、异步信息收集接口、风控策略）、风控运营
- 规则平台：场景、规则、因子（最小逻辑单元）；策略 vs 决策
- 验证中心、累计服务、处罚中心、算法平台
- 风险前：风险教育、参与业务、数据准备、主动防护
- 风险后：初步受理、核查审理、案件处理
- 数据体系：事件快照、聚合事实、衍生信息、基础数据
- 从对手（黑产）学习：服务功能切分到细粒度、利益敏感（业务熟悉）
- 风控团队需要考量：控制风险是否现实、团队人才质量与数量是否足够、团队价值观是否统一、对风险是否足够了解、是否得到上层支持

## aliyun - 云课堂 - docker 2016-12-3 21:07:40

- Docker与容器服务扩展机制：目前还停留在 docker 的使用上，所以服务扩展暂时不深入
- 阿里聚石塔电商云容器服务应用和实践
- 基于Docker的微服务实战：以Spring Cloud为例
- 基于Java容器的多应用部署技术实践：关键、核心、热点用户访问路径上容器压缩部署（本地调用 深拷贝 vs 远程调用 序列化）；应用多版本共存，减少 发布、回滚 时间
- 云上高质量软件之路 - 持续交付的道与术：环境带来各种问题；开发只交付代码，但运维起来还需要环境；docker 和 集装箱
- Docker加速云端应用交付与创新：docker 和 lego；docker 为 **交付** 而生；关于持续交付，只有一个确定的问题，生或死；dockerfile + 编排模板（compose） + docker api

## window 容器 2016-12-1 21:06:30
> https://msdn.microsoft.com/zh-cn/virtualization/windowscontainers/containers_welcome
> https://master.dockerproject.org/

window 原生容器、docker for window、docker toolbox 都尝试了，最后推荐 docker toolbox -》 来自 阿里云 - 容器市场

## node 基础教程 2016-12-1 11:14:01
> http://www.runoob.com/nodejs

- require() 引入模块，npm 安装模块
- REPL：read eval print loop，交互式解释器
- 异步编程依托于回调来实现，但不能说使用了回调函数就异步化了
- 事件循环：EventEmitters -> Evnets -> Event Loop -> Event Handlers，类似于 **观察者模式**
- EventEmitters：所有事件类的原型
- Buffer：js 原生只有字符串数据类型，没有二进制数据类型，但是处理 TCP流、文件流 时必须使用二进制数据
- Stream：抽象接口，比如 http.request、stdout；4 种类型 RWDT；都是 EventEmitters 实例，常用事件有 data、end、error、finish
- 模块系统：require + exports
- 函数：函数作为参数传递、回调
- 路由：url + queryString 模块
- 全局变量：`__filename, __dirname`；全局函数：`setTimeout(), clearTimeout(), setInterval()`；全局对象：`console, process, Process`
- 常用工具： util 模块、OS、Path、Net、DNS、Domain
- 文件系统：fs 模块；所有方法都有 同步 + 异步 版本
- 获取 get、post 请求：难道不能用其他 method 方法
- web 模块：http 模块；web 应用架构 client -> server -> business -> data
- Express 框架：nodejs web 应用框架，中间件 + 路由表 + 模板渲染html
- restful api：Representational State Transfer；GET、PUT、DELETE、POST；软件架构风格，设计风格而非标准
- nodejs 多进程：exec、spawn、fork
- JXcore：基本不需要对你现有的代码做任何改动就可以直接线程安全地以多线程运行

## Node初学者入门，一本全面的NodeJS教程 2016-11-30 20:57:00
> http://ourjs.com/detail/529ca5950cb6498814000005

- jquery 会让你用得很爽，但是只能让你成为一个 js 用户，而不会成为一个 js 开发者
- 应用的不同模块分析，比如：http 服务器、路由、请求处理程序、请求数据处理能力、视图逻辑、上传功能
- 进行函数传递：将函数作为参数传递
- 基于事件驱动的回调
- 实现模块
- http: method + url.parse + querystring
- 依赖注入来实现 server 模块组合 router 模块
- 函数式编程 -》 行为驱动执行 -》 router -> requestHandlers
- js *关联数组*
- 阻塞与非阻塞：node 单线程，通过 event loop 实现并行；return -》 阻塞；要小心非阻塞下引起的 **非顺序执行**；使用 **函数传递** 达到非阻塞的效果
- 处理 POST 数据：requestHandler 上添加 listener，监听 data 和 end 事件
- node 内置模块直接 require 就行，外部模块 npm install 就好了

## 金融蚂蚁金融科技峰会 2016-11-28 19:33:07

密码已死 -》 行为特征 + 生物特征

优化支付体验 + 解决核身难题 + 增强实人认证

蚂蚁风控系统：设备位置 -》 习惯 -》 关系 -》 行为 -》 账户

人工智能助力普惠金融：蚂蚁智能客服、蚂蚁安全大脑、芝麻信用、微贷、保险

数字金融：金融、信任、连接、计算

云服务助力蚂蚁开放生态：这里云服务应该指的 EWS

## 阿里聚石塔电商云容器服务应用和实践

容器化 Paas 平台：EWS；PaaS 容器云 -》 高质量互联网架构 -》 IT 解决方案产品化

C2B：

- 成本 -》 速度 -》 质量
- 功能第一，多样灵活，关注开发，强调成本
- 高质量架构，标准化，关注运维，强调质量

典型架构演进：

- 2层裸奔：web + mysql
- 负载均衡 + 灾备：nginx cdn web api mysql主从
- 4-7层覆盖 + 全面缓存加速：增加 LVS api长连接 memcache等
- 服务化：DDos queue cacheProxy DBProxy NFS
- 单元化：异地

高质量架构能力产品化输出：把自己的系统建设成高质量架构，和把高质量架构作为一种能力输出完全不一样

向互联网架构迁移：去IOE；软件SaaS化；架构互联网化

### ews 实现

互联网架构八荣八耻：

- 可配置 vs 硬编码
- 可互备 vs 单点
- 可无状态 vs 有状态
- 可随便重启 vs 不能迁移
- 整体交付 vs 部分交付
- 标准化 vs 特殊化
- 自动化运维 vs 人肉运维
- 无人值守 vs 人工值班

高质量架构 6 个维度 20 个能力：

- reliability：异地多活 负载均衡
- scalability：弹性伸缩 海量
- performance：应用、链路、语言 profile，压测
- availability：监控告警 健康检查 故障迁移 ip漂移
- maintainablity：优雅发布 日志检索 可视化配置 单元化 服务化
- security：ssl DDOS/CC XSS

EWS 系统总架构图：

- 用户访问链路 -》 接入层子系统 -》 EWS 容器 + 日志监控子系统（storm） + 核心监控
- 用户控制台：多机房部署 弹性计算 可视化运维
- 系统运维控制后台：后台管控系统 agent和oxs服务管控 路由/镜像/虚拟化网络

多机房资源池：

- 命令方式；EWS 镜像的 ECS 主机
- 资源 OS 化：cpu 内存 带宽 资源调度
- 快速新建机房

官方 service：

- 服务化：后端软件服务化，以服务为最基本执行单元
- 广度：官方镜像覆盖 80% 常用系统软件
- 深度：功能 + 性能 + 稳定性 + 可维护性

EWS 系统模型：

- region：地区，北上广
- service group：测试环境 预发布环境
- service：web cron mysql
- container 和 ECS：可独占也可以混合部署
- 一个service可以属于不同的ECS，也可以属于同一个ECS
- POD是多个service的逻辑组合，系统编排和调度以POD为单位

service 管理：

- 包发布：大文件，断电续传，zip、rar
- git发布：每个service一个独立的git仓库
- 灰度发布：service group
- 回滚发布：每个service保存最近10个发布版本
- 预发布：2个service分为一组，S1作为S2的预发布环境

接入层 - 功能：

- 域名：每个应用提供一个域名，可以通过 CNAME 添加新域名
- 负载均衡：7层（http & https）
- 安全高防：云盾 + 高防IP + TMD + WAF：DDOS + CC + SQL注入 + XSS + 跨站
- 健康检查：应用级健康检查 端口网络检查 脚本健康检查

接入层 - 负载均衡和健康检查：

- 每一个service，下面的所有container，会 Round-Robin 负载均衡
- service 域名、service 下的 container 都有健康检查
- 域名健康检查主要检查连通性
- container 健康检查主要检查可用性（ECS是否挂了）
- 可以 **自定义健康检查脚本**

弹性计算 - 功能：

- 系统编排和混布：资源如何组织和分配 -》 新建 + 依赖关系编排 + 资源池化
- 弹性扩容和缩容：资源如何调度 -》 优雅发布/热升级/不停服 + 垂直/水平 + 手动/自动/规则引擎
- 健康检查和迁移：如何和监控系统打通 -》 机器/应用故障 + 有状态/无状态/ip地址漂移/域名漂移 + 检测/恢复规则引擎

监控 + APM：

- 监控：应用监控 报警 日志 数据库
- APM：探针

## aliyun - 有货 2016-11-27 16:21:16

为何选择混合云：

- 业务痛点：快速响应；弹性伸缩；流量峰值
- 运维痛点：CMDB 流程繁琐；故障处理耗时耗力；服务器环境差异；硬件资源分配
- 成本控制：硬件；运维；迁移
- 安全控制：数据、网络、应用

系统架构：

- 客户端：httpdns 缓存 降级 异常检测
- 入口层：智能dns 高防ddos slb nginx
- 网关层：安全 流控 降级 熔断 异步化
- 服务层：服务注册、发现、调用、SLB
- 缓存层：热点数据加速、缓存更新
- 数据层：双活、实时性、一致性、failover
- 运维平台 + 大数据平台

客户端：

- httpDNS，解决 localDNS 潜在问题：dns 劫持，慢或者失败
- CDN 加速静态资源
- 预加载和客户端缓存：通过 Cache-Control HTTP 头来定义自己的缓存策略
- 服务降级：非关键业务降级，保证关键业务高可用
- 网络质量监控：不同网络环境设置不同超时时间、并发数量，根据不同网络质量设计不同产品体验（比如 图片质量）
- 业务异常监控：实时上报异常数据，实时定位分析问题
- app 出现故障快速切换到 h5 模式

入口层：

- 智能DNS：分发流量至双中心，突破运营商地域限制，按照地域切分流量
- 高防 DDOS
- SLB

网关层：

- 安全控制：统一客户端身份认证，统一完成数据加密解密
- 分流与限流：流量按业务切分，实现后端服务水平扩展；设置流量阀值，自动限流，防止雪崩效应
- 服务降级
- 熔断机制：根据后端服务健康状况，自动熔断，防雪崩
- 异步化：异步化调用后端服务，避免长期占用服务请求线程，快速响应处理结果，快速释放线程资源
- 服务聚合
- 一级缓存加速热点数据（库存等 秒级分钟级，详情 小时级）
- 二级缓存容灾（24小时）

缓存层：

- 用户数据持久化（如 收藏夹、浏览记录）：用户 -》 微服务 -》 MQ -》 redis 服务
- 共享数据加速，强数据一致性（如 订单数据）：单写多读，主从同步
- 共享数据，不考虑数据一致性（如 商品数据）

数据层：

- 同城双活：业务层保证数据的实时性和最终一致性
- 业务层双写，数据异步分发
- 业务层通过二级查询保证数据实时一致性
- 重复写入应对单机房故障
- 通过 failover 库为高可用提供双重保险
- 垂直拆分 水平拆分

服务化：

- 客户端：app web
- 服务网关 Gateway
- 商品中心 会员中心 订单中心 + 服务消费者 服务提供者 服务监控 SLB 性能优化 流控/降级
- 服务注册中心：服务注册、发现、调用；zookeeper + web 控制台

LB：

- 一个服务至少部署 2 个以上实例
- 基于注册中心的客户端寻址访问模式
- 服务提供者集群动态调整不影响客户端
- 服务消费者负责对服务提供健康检查

服务降级：

- 配置服务超市时间：直接返回或执行 fallback 逻辑
- 服务调用结果：成功、失败、超时、线程拒绝、短路
- 熔断
- 基于 Hystrix

流量控制：

- 计数器服务，比如 600次/分钟 调用
- 为每个服务提供线程池，线程池已满，调用立即拒绝，默认不排队，快速失败机制

服务监控 性能优化 调用链分析（为请求分配一个trace_id）

自动化：

- 自动发布和回滚
- 业务实施数据监控
- 应用运行状态监控
- 系统故障监控
- 第三方服务质量监控
- 故障快速恢复
- 系统容量规划

服务拆分：面向模型，细粒度化模型

性能调优：当前的性能情况 -》 耗时拆分；性能目标

高可用：相信任何系统都会故障，故障不能导致系统瘫痪

## aliyun - 游族网络 2016-11-27 15:40:22

游戏架构：

- 第一代：物理机为主
- 第二代：虚拟化技术，all in one
- 第三代：按角色分拆并形成服务集群模式，游戏逻辑以服务进程或者集群配置项的形式提供服务

游族私有云：

- 业务需求：服务器数量；服务器利用率；开服速度快，分钟级
- 技术实现：openstack；网络采用 VLAN 模式，最大限度和现有网络兼容；本地磁盘存储
- 最终效果：90%+ 游戏；虚机 10000+；封装接口和运维平台对接

运维进度：手工 -》 批量 -》 系统化

游族作业平台：

- API接口 任务调度器 指令仓库
- 任务列表 全局任务队列 本地任务队列
- agent
- 日志服务

数据备份恢复

老游戏平滑迁移：

- 要求：正常版本更新时间
- 提前准备资源：ecs；vpc 实现内网互通，为数据同步做好准备
- 提前同步数据：xtrabackup 配置 mysql 主从模式，备份数据到 RDS
- 效果：准备 3-5 天，迁移 1-2 小时

自建 mysql 和 RDS 的选择：业务规模小，无需过多优化；备份机制太难实现；RDS 相对 ecs 自建成本略高一些

成长：对行业的热爱，保持投入，持续学习

## aliyun - 微博 2016-11-27 14:44:59

Docker Cloud Platform：

- 初心：弹性能力；节约成本；平台化

架构设计：

- 公有云+私有云：公有云按需付费；业务能在公有云和私有云上无差异化部署
- 服务化：各组件仅通过 restful api 通信；各组件应具有良好的扩展性，可插拔
- 可伸缩：无状态、无单点、运维操作自动化

架构分层：

- 不可变基础设施：容器化；系统初始化；镜像分发；带宽监控；
- 弹性调度：业务跨云调度；调度机制；容量评估
- 服务发现：配置中心；负载均衡；RPC；资源
- 容器编排：自动扩缩容；监控报警

### 不可变基础设施

容器化：

- 所有业务均已 Docker 镜像分布
- 云的伸缩性推荐单实例部署
- 基础运行环境：centos -》 devicemapper-direct-lvm -》 docker -》 consul -》 swarm -》 mesos -》 cAdvisor -》 java + php

初始化：

- 流水线：各 Stage 尽可能并行化；api -》 启动 ECS -》 初始化 Stage
- 异步化：Ansible 的 Callback 机制
- 水平扩展：实现 Ansible 自动伸缩功能

镜像分发：

- 降低镜像大小：不变基础镜像；本地 load
- 反向缓存：在 IDC 节点缓存；最新镜像自动同步
- 自动伸缩：分发网络自动伸缩
- P2P 分发

混合云网络架构：

- 公有云 VPC：构建与专有云内网一致的网络环境
- 网络高可用：多专线
- 路由：就近转发 -》 低延迟；网络故障 -》 自动启用备份路由

带宽监控：跨云专线监控；ip 级别；自动聚合到产品线

### 弹性调度

业务跨云弹性调度：

- 最小规模部署
- 优化带宽：资源 local 化，尽量减少跨专线请求；跨专线请求开启压缩
- 数据同步：基于消息的缓存同步机制；延时、容错

弹性调度机制：

- scheduler api：swarm + yarm + mesos
- elastic partition api：搜集设备资源情况

容量评估体系

服务发现：nginx upsync，基于 consul，解决 reload 性能问题

### 问答

ecs：有的 ecs 做了很多 io 的优化，适合做 meecache/redis 等实例，有的适合作为普通的服务器

## aliyun - 涂鸦科技 2016-11-26 22:30:13

产品演变：爱相机app -》 涂鸦智能（连接智能设备公司和硬件厂商）

架构设想 - 最初的梦想：

轻架构 - 第一代：

- 入口： pc h5 app 第三方合作伙伴
- atop 网关：接口配置化 访问控制 数据转换 统一日志
- 业务层：client atop dao&common service mq task
- 基础服务：client（unit） dao&common service

刚开始并没有做容量评估，都再一台机器上，发布只发一台

轻团队 - 架构目标：

- 前后端分离
- 业务通过网关暴露
- 统一封装技术模型
- 网关统一授权 + 用户模型特征验证（安全风险）
- 配置化配属（应对多变需求）

平行架构 - 第二代：

- 业务架构：pc/h5 app 开发者平台 商家服务平台 运营管理平台 第三方
- 应用架构： ATOP网关（访问控制、数据转换、服务寻址、统一日志、A/B TEST） 云proxy（第三方数据转换） mqtt集群（数据还原、设备认证、心跳检测）
- 技术架构：服务化治理Dubbo（服务注册、协议转换、fallover、服务监控） SOA服务化（用户、网关、设备、产品） 中间件（监控、队列、任务调度、数据库组件、配置管理、日志搜集）
- 数据服务：cache 日志分析 搜索 mysql nosql Hadoop
- 任务/消息集群：数据分析、视频加速、图片加速

企业级分布式应用服务（EDAS，Enterprise Distributed Application Service）可以用来取代 Dobbo （但是国外的云平台就用不了了）

自己实现数据库中间件：国内国外部署；分库分表；水平扩展

架构支持：

- 数据：峰值 30T 上传；几十亿用户核心数据；实时日志搜索、分析报警；离线和实时数据处理（ODPS+EMR）
- 模块化：业务服务化拆分可独立部署；服务治理工具分析服务调用情况按需扩容；性能和可用性监控及时发现技术瓶颈；热发布
- 网关：隔离内外数据；通过网关实现业务场景组装；多种安全机制适配多种业务场景；平行扩展；统一日志出入口
- 中间件：数据库中间件实现分库分表、中从读写；mq中间件方便架构选型；配置中心化

SLB 是有流量上限的，所有最好按照业务进行一定的划分，也要做 SLB 的监控

数据传输(Data Transmission) 支持以数据库为核心的结构化存储产品之间的数据传输：比如需要服务国内国外，需要数据互通

包月购买：阿里云技术更新非常快，新技术可能需要重新购买

RDS：云上云下互通；主从

涂鸦在云上：

- 访问控制（Resource Access Management）：超级key；client/server 公用key；细化权限到用户级；业务权限拆分减少安全风险
- 云监控：云服务（ECS/RDS/OCS）常规监控；自定义监控服务存活、可用性、性能、稳定性
- SLB 内部服务管理：内网免费使用；管理 ZooKeeper 集群
- OSS 小技巧：自定义Header属性支持业务需求；图片服务，降低成本；管理内部工具

经验分享：基于 ESC API 的主机管理和高可用监控

创业：技术、团队（更好的测试、更好的客户端协同、更深入了解业务）

更好的架构：技术层面可能比较浅，但是很多事情经历过；没有最好，只有最适合服务

## aliyun - 美柚 2016-11-26 21:29:22

美柚（meet you）：让女性更美更健康；从女性的需求出发

数据流：

- ODPS（PB级数据仓库）
- ADS：分析型数据库(Analytic DB)；对 BI 非常友好
- 阿里云：大规模数据计算，算法模型训练，部分数据结果回流
- 托管机房：实时数据计算，增量数据回流
- 重要数据双活，小时同步

api 实时监控：

- 阿里云盾：DDoS高防IP
- 自研：全链路服务质量监控，保证用户体验；移动端实时业务监控与预警

大数据智能挖掘（各个面相互转化）：

- 用户：智能推荐，个性化定制
- 社区、服务平台：社区 UGC；健康数据监控；用户行为数据
- 品牌商、广告主：营销效果监控；精准广告
- 社群电商：兴趣型、产品型、知识型、工具型；精准社区需求挖掘；优质商品聚合裂变传播

多维度用户数据 -》 用户画像 -》 洞察和服务女性用户：

- 记录：健康；心情
- 社区：用户行为；发帖、搜索、问答、知识库、密友
- 电商：浏览；购物
- 其他：用户信息（婚姻、年龄、星座、地域、身份、手机）
- 数据抓取：微博、qq空间

用户记录分析：

- 习惯、健康监控、单点（孕）
- 活跃分析
- 关注女性健康、个性化贴士、科普

多维度用户标签：基础属性、行业、兴趣

产品地图：首推、个推、个搜、BI、反垃圾、实时业务监控、SSP、DMP、AD Exchange、情感分析、舆情分析、关联推荐

社区反垃圾算法（storm）：

- 文本数据 -》 特征处理、选取 -》 分类器模型训练 -》 分类器模型 -》 文本识别 -》 垃圾帖
- 圈子过滤（Simhash） -》 相似帖统计 -》 异常帖
- kafka -》 实时帖子 -》 白名单（圈主、马甲、达人堂） -》 垃圾帖、相似帖 -》 汇总策略 -》 社区库、kafka、其他

程序员成长：毕业到技术总监 -》 规划、目标；大数据 -》 紧密结合应用场景 / 离线计算、流计算（准实时）、实时计算（用户当前搜索）

人工智能：未来的发展方向，正在投入；机器学习 + 大数据

高并发：多语言尝试（java、php、nodejs）；削峰（晚上 7~9 点）；云上的高弹性

## aliyun - 驴妈妈 2016-11-26 20:51:02

 架构演变：

 - 基本完成第三阶段 SOA 服务分拆和高可用治理
 - 向弹性计算，云服务发展

 服务拆分：按照业务线拆分；异步化非常长的业务线

 数据库架构：读写分离（普通项目需要通过 **数据库中间件**）；业务分库；异构复制

 数据分析系统：

 - 产品数据分析：同行业产品数据和价格变动；实施准实时策略，从而完善精准运营；丰富用户行为数据，完善推荐模型，提高推荐准确度
 - OTA 产品数据分析：产品标准化低

 云方案：

 - OTA 同行数据
 - 阿里云：数据采集（产品主要信息，浏览量） -》 Hadoop 集群 -》 报表格式存储
 - 驴妈妈 IDC：搜索模块（产品匹配）；价格模块（价格预警、价格调整推荐）；推荐模块（推荐权重调整）；产品模块（增加采集任务）

 经验分享：

 - 系统监控（分析数据的趋势，看看是否存在异常态）：heap memory；old generation；virtual memory；tcp connection / open file；http thread；database cpu%（高和低都有问题）
 - 迅速提升互联网系统（弯道超车）：参与每一次系统问题的解决过程中；认真分析、总结每一起隐患与故障；跳槽

 OTA 的挑战：价格波动大（短时间重新计算）；对接非常多的运营商（来自运营的挑战）；需要对接很多外部系统，保证自身的稳定；用户体验（比如 一买到票就及时生效）

 简单说应对高并发就是 **拆**，但是难度就是在怎么拆上面

 互联网产品：业务变化快，节奏的把握；最求几个 9；系统速度、容量、预估极限

 深度学习：不紧机器和计算机如此，人也需要如此才行

## aliyun - 空格 app 2016-11-26 20:00:12

架构：client -》 云盾 + SLB -》 user server + merchant server + IM/PUSH （ECS） -》 搜索推荐引擎（OpenSearch） + RDS -》 日志服务（OpenSearch） + 实时计算 + 离线计算 + 云监控 + 数据中心（BI DPC/DTS）

业务结构：

- 用户服务端；商家服务端；CRM 管理；IM/PUSH 服务器
- 业务层 Search Manager；分布式缓存（OCS）；分布式表格格式（OTS）
- 路由
- OpenSearch
- RDS ODPS

RDS：传统的数据库在数据量的时候就要考虑分库分表了，而 RDS 只需要配置就行了

OpenSearch：传统搜索引擎遇到数据量的时候更新索引比较困难，而 OpenSearch 也只需要更改配置

BI：数据报表由 T+1 通过 日志服务，升级到 实时

阿里云 数据服务：个性化推荐、数据可视化、大数据计算

OpenSearch - 搜索业务：

- 普通工程需要按场景构建不同 search node
- 在线：api 接入；灵活多样的语法；支持复杂排序；丰富的辅助功能
- 离线：简单配置就可以创建索引；字段增删操作简单；无缝对接 RDS ODPS；索引构建任务可灵活配置
- 实时更新
- 运维：无需自建集群；无需管理数据备份和冗余；无需考虑扩容

搜索服务对比：普通工程需要按需构建不同 search node，aliyun 只要接入 OpenSearch 即可

推荐：
- 个性化；大数据；分布式（服务 + 计算）；弹性； 迭代迅速
- 在线服务：OTS OCS
- 推荐引擎：OpenSearch
- 计算处理：模型训练 ODPS
- 数据集成：日志服务；数据传输；彩云间（DPC，可视化分析）

数据平台架构：
- 顶层数据： ODPS RDS 日志服务 云监控 彩云间（现在可以 **数据可视化** 了）
- 顶层数据： 离线计算框架 实时计算框架
- 中间层：系统数据 应用数据 业务数据
- 应用层：运营数据 渠道数据 用户数据 监控数据
- 服务层：数据门户 Ranking/QR OpenAPI

手机门户：
- 底层数据准备
- 前端：bootstrap + Echarts
- 对接 钉钉 - 微应用

数据库高并发：缓存；读写分离
搜索高并发：弹性扩容
搜索非常多：搜索整体架构为可配置的，新增搜素增加配置即可
阿里云：把技术人员从底层解放出来，更关注业务迭代

## aiyun - 虎嗅网 2016-11-26 19:26:44
架构演变：单机（ECS） -》增加 mail 网关 -》 增加 数据库（RDS）-》增加图片服务器 -》 SMS 网关 + 静态服务器（js、css）-》多机 + SLB -》增加缓存（MEM）-》防火墙 -》垃圾过滤（反欺诈）-》搜索系统（OpenSearch）-》评论系统 + 数据统计

图片存储（静态资源 推荐使用 OSS）：
- 剪裁：分发不同平台（web、app）；全能缩放，品质调整，webp
- 加速：响应速度非常重要
- 分发：多 CDN（防单点故障）
- 外图缓存：自动下载本地（外图可能限制带宽）

主动式缓存管理：
- 业务缓存：基础数据经过业务逻辑处理后缓存起来（比如 主页）；减少 cpu 计算量，减少用户等待时间；map（数据之间的联系） 式管理方式（数据变动，根据 map 关系更新所有数据）
- 基础数据缓存：取出数据直接缓存；减轻数据库压力，提高网站响应；改造 Model 层

架构思想：
- 贯穿始终的解耦：需求变化快，开发资源少
- 保持简单的结构：保持低成本的弹性扩展
- 尽量使用云服务：减少维护成本

## 只是为了好玩 2016-11-24 19:44:22
生活的意义：生存、社会秩序、娱乐；性、战争、linux
人生的金科玉律：己所不欲勿施于人；以自己做的事为荣；还要乐在其中

## aliyun - 小咖秀 2016-11-24 12:55:10
> 一定要能 **拆**

爆款：指数级增长；*现象级应用* 的审美疲劳

高可用设计：
- 集群化，无单点，支持纵横扩容
- 模块化拆分，服务化组合；功能模块分层独立
- 数据持久化存储灵活调配；数据库分库分表读写分离；读 -》缓存，写 -》异步队列
- 尽可能使用缓存
- 耗时操作异步队列化

模块化：负载均衡 - url 路由 - 业务集群 - 缓存集群 - 数据库集群
url 分层：二级目录（非二级域名），比如 用户、评论、视频、图片；按接口、页面分层
> redis 和 memcache 的选择：http://blog.csdn.net/sunmenggmail/article/details/36176029
大部分场景 redis 都 ok，但是 数据量过 100k / 只有 k-v 结构，memcache 性能更好
php 代码直接放到内存中
修改表结构：使用新库，同步完数据后修改，正常后切换到新库
应用关键指标：峰值；缓存命中率（90%以上）
安全（系统 & 政策）：第三方鉴黄服务；监控
